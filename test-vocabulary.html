<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生词本删除功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .vocab-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #eee;
            border-radius: 3px;
        }
        .vocab-btn {
            margin: 0 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .vocab-btn:hover {
            background-color: #f0f0f0;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>生词本删除功能测试</h1>
    
    <div class="test-section">
        <h2>问题说明</h2>
        <p>原来的删除功能存在以下问题：</p>
        <ul>
            <li><strong>索引不稳定</strong>：删除一个生词后，其他生词的索引会变化，可能导致删除错误的生词</li>
            <li><strong>缺少确认机制</strong>：没有删除确认，容易误删</li>
            <li><strong>没有错误处理</strong>：删除失败时用户得不到反馈</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>修复方案</h2>
        <ul>
            <li>✅ 使用单词名称和添加时间作为唯一标识，而不是数组索引</li>
            <li>✅ 添加删除确认对话框</li>
            <li>✅ 添加错误处理和用户反馈</li>
            <li>✅ 添加成功删除的提示消息</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>修复后的代码变化</h2>
        <h3>1. 生词列表渲染</h3>
        <pre><code>// 原来：使用数组索引
onclick="removeWord(${index})"

// 修复后：使用唯一标识
onclick="removeWordSafe('${item.word}', '${item.addedAt}')"
data-word="${item.word}" data-added-at="${item.addedAt}"</code></pre>

        <h3>2. 删除函数</h3>
        <pre><code>// 新增安全删除函数
window.removeWordSafe = function(word, addedAt) {
  // 1. 添加确认对话框
  if (!confirm(`确定要删除生词 "${word}" 吗？`)) {
    return;
  }

  // 2. 使用精确匹配而不是索引
  const indexToRemove = vocabulary.findIndex(item => 
    item.word === word && item.addedAt === addedAt
  );

  // 3. 添加错误处理和用户反馈
  if (indexToRemove !== -1) {
    // 删除成功
    showMessage(`已删除生词: ${removedWord.word}`, 'success');
  } else {
    // 删除失败
    showMessage('未找到要删除的生词', 'error');
  }
};</code></pre>
    </div>

    <div class="test-section">
        <h2>测试建议</h2>
        <ol>
            <li>添加多个生词到生词表</li>
            <li>尝试删除中间的生词，确认删除的是正确的单词</li>
            <li>快速连续点击删除按钮，确认不会删除错误的生词</li>
            <li>检查删除确认对话框是否正常显示</li>
            <li>检查删除成功/失败的提示消息</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>兼容性说明</h2>
        <p>为了保持向后兼容性，我们保留了原来的 <code>removeWord(index)</code> 函数，但添加了索引边界检查。新的删除功能使用 <code>removeWordSafe(word, addedAt)</code> 函数。</p>
    </div>

    <script>
        console.log('生词本删除功能已修复');
        console.log('主要改进：');
        console.log('1. 使用唯一标识而不是数组索引');
        console.log('2. 添加删除确认');
        console.log('3. 添加错误处理和用户反馈');
    </script>
</body>
</html>