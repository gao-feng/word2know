# Anki 同步设置指南

本插件支持直接将生词同步到Anki，无需手动导入CSV文件。要使用此功能，需要先安装和配置Anki Connect。

## 安装步骤

### 1. 安装Anki
- 访问 [Anki官网](https://apps.ankiweb.net/) 下载并安装Anki
- 支持Windows、Mac、Linux等平台

### 2. 安装AnkiConnect插件
1. 打开Anki
2. 点击 "工具" → "插件"
3. 点击 "获取插件"
4. 输入插件代码：`2055492159`
5. 点击 "确定" 下载安装
6. 重启Anki

### 3. 配置AnkiConnect
AnkiConnect默认在端口8765运行，通常无需额外配置。

如需自定义配置，可以在Anki的插件文件夹中找到AnkiConnect配置文件。

## 使用方法

### 自动同步
1. 确保Anki已启动
2. 在浏览器插件中点击 "🔄 同步" 按钮
3. 插件会自动：
   - 检查Anki连接
   - 创建 "英语生词" 牌组（如不存在）
   - 将未同步的生词添加到Anki
   - 标记同步状态

### 同步状态说明
- ✓ 绿色：已同步到Anki
- ○ 橙色：未同步
- 生词表会显示同步统计信息

### 增量同步
- 只有新添加的生词会被同步
- 已同步的生词不会重复添加
- 支持批量同步多个生词

## 卡片格式

同步到Anki的卡片格式：
- **正面**：英文单词
- **背面**：详细的单词信息（见下方）
- **标签**：vocabulary, english, browser-extension
- **牌组**：英语生词

### 详细单词信息
每个卡片的背面包含：
1. **中文翻译**：Google翻译结果
2. **发音标注**：国际音标或简化发音
3. **英文释义**：来自权威词典的英文定义
4. **词性标注**：名词、动词、形容词等
5. **同义词**：相关的同义词列表
6. **反义词**：对应的反义词（如有）
7. **例句**：实际使用示例
8. **🔊 真人发音**：Google TTS音频文件

### 词典数据源
- **主要来源**：Free Dictionary API (dictionaryapi.dev)
- **备用来源**：WordsAPI (RapidAPI)
- **音频来源**：Google Text-to-Speech
- **翻译来源**：Google Translate

### 音频功能
- 自动获取Google TTS真人发音
- 音频文件直接嵌入到Anki卡片中
- 支持在Anki中直接播放发音
- 离线可用（音频已下载到本地）

## 高级功能

### 自定义牌组名称
可以修改 `anki-connect.js` 中的默认牌组名称：
```javascript
async addNote(word, translation, pronunciation, deckName = '你的牌组名称') {
```

### 自定义卡片模板
可以在Anki中创建自定义笔记类型，然后修改代码中的 `modelName`。

### 批量操作
- 支持一次同步多个生词
- 自动处理重复检查
- 错误处理和重试机制

## 故障排除

### 常见问题

**Q: 提示"无法连接到Anki"**
A: 
1. 确保Anki已启动
2. 检查AnkiConnect插件是否正确安装
3. 确认端口8765未被其他程序占用
4. 重启Anki和浏览器

**Q: 同步后在Anki中找不到卡片**
A:
1. 检查 "英语生词" 牌组是否存在
2. 在Anki中搜索标签 "vocabulary" 或 "english"
3. 确认同步过程中没有错误提示

**Q: 音频无法播放**
A:
1. 确认Anki音频设置正常
2. 检查卡片背面是否有🔊音频标记
3. 尝试重新同步该单词
4. 检查网络连接（获取音频需要网络）

**Q: 词典信息不够详细**
A:
1. 确保网络连接正常（需要访问词典API）
2. 某些生僻词可能缺少详细信息
3. 插件会自动使用多个词典源
4. 如果所有词典都失败，会显示基本翻译

**Q: 同义词和例句显示不全**
A:
1. 为了保持卡片简洁，限制了显示数量
2. 同义词最多显示5个，例句最多显示2个
3. 可以在词典网站查看完整信息

**Q: 部分生词同步失败**
A:
1. 检查生词内容是否包含特殊字符
2. 确认Anki存储空间充足
3. 重试同步操作

**Q: 想要修改卡片格式**
A:
1. 在Anki中找到对应的笔记类型
2. 点击 "卡片" 按钮自定义模板
3. 可以添加CSS样式和JavaScript功能

### 网络问题
- AnkiConnect使用本地连接（localhost:8765）
- 不需要互联网连接
- 防火墙通常不会阻止本地连接

### 性能优化
- 建议一次同步不超过100个生词
- 大量生词可以分批同步
- 定期清理不需要的生词

## 技术细节

### API接口
插件使用以下AnkiConnect API：
- `version`: 检查连接
- `deckNames`: 获取牌组列表
- `createDeck`: 创建牌组
- `addNote`: 添加单个笔记
- `addNotes`: 批量添加笔记
- `findNotes`: 查找笔记

### 数据格式
生词数据结构：
```javascript
{
  word: "单词",
  translation: "翻译",
  pronunciation: "发音",
  addedAt: "添加时间",
  ankiSynced: true/false,
  ankiNoteId: "Anki笔记ID",
  syncedAt: "同步时间"
}
```

### 错误处理
- 连接失败自动重试
- 牌组不存在自动创建
- 重复内容自动跳过
- 详细错误信息提示

## 更新日志

### v1.3
- 新增Anki直接同步功能
- 增量同步支持
- 同步状态可视化
- 批量操作优化

### 未来计划
- 支持自定义牌组选择
- 双向同步（从Anki导入）
- 同步历史记录
- 更多卡片模板选项